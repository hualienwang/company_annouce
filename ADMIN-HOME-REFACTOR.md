# 管理后台与首页功能重构

## 概述

根据用户需求，对管理后台和首页进行了重构：
1. 将所有公告及回复功能从管理后台移除
2. 将删除功能迁移到公司公告页面
3. 在首页增加搜索公告及意见询问的功能

## 主要改动

### 1. 管理后台（Admin.vue） - 简化为员工管理

**移除的功能**：
- 创建公告/意见询问表单
- 公告列表展示
- 回复列表展示
- 删除公告功能
- 下载文件功能

**保留的功能**：
- 员工列表展示
- 新增员工功能
- 删除员工功能

**文件修改**：`frontend/src/views/Admin.vue`
- 删除所有公告相关的UI组件
- 删除所有公告相关的逻辑代码
- 简化为纯粹的员工管理页面
- 标题改为"员工管理"

### 2. 首页（Home.vue） - 增强为公告管理中心

**新增的功能**：

#### 2.1 搜索功能
- 添加搜索框，支持搜索公告标题和内容
- 实时过滤显示结果
- 搜索时自动重置到第一页

#### 2.2 管理员专属功能（仅管理员可见）
- **新增公告按钮**：蓝色背景
- **新增意见询问按钮**：紫色背景
- **删除按钮**：每个公告卡片右侧显示红色删除按钮

#### 2.3 创建公告表单
- 点击"新增公告"或"新增意见询问"按钮显示
- 包含标题和内容输入框
- 创建成功后自动刷新列表

#### 2.4 删除公告功能
- 管理员可以在首页直接删除公告/意见询问
- 删除前有确认提示
- 删除成功后自动刷新列表

**文件修改**：`frontend/src/views/Home.vue`

### 3. 技术实现细节

#### 3.1 搜索与过滤逻辑
```typescript
// 过滤后的数据
const filteredData = computed(() => {
  let data = allData.value

  // 搜索过滤
  if (searchQuery.value.trim()) {
    const query = searchQuery.value.toLowerCase()
    data = data.filter(announcement =>
      announcement.title.toLowerCase().includes(query) ||
      announcement.content.toLowerCase().includes(query)
    )
  }

  // 类型过滤
  if (filterType.value) {
    data = data.filter(announcement => announcement.type === filterType.value)
  }

  return data
})
```

#### 3.2 权限控制
```typescript
// 使用 authStore 判断是否为管理员
import { useAuthStore } from '../stores/auth'

const authStore = useAuthStore()

// 模板中根据权限显示/隐藏功能
<button v-if="authStore.isAdmin">删除</button>
```

#### 3.3 客户端分页
- 一次性获取所有数据（最多100条）
- 前端进行搜索和过滤
- 前端进行分页切片
- 搜索或筛选时自动重置到第一页

## 功能使用说明

### 普通用户
1. 查看所有公告和意见询问
2. 使用搜索框搜索公告
3. 按类型筛选（全部/公告/意见询问）
4. 点击公告查看详情和回复

### 管理员
1. 拥有普通用户的所有功能
2. 点击"新增公告"按钮创建公告
3. 点击"新增意见询问"按钮创建意见询问
4. 在公告卡片右侧点击"🗑️ 删除"按钮删除公告
5. 访问 `/admin` 管理员工账号

## 访问路径

- **首页**：`/` - 公司公告列表（管理员可删除）
- **管理后台**：`/admin` - 员工管理

## 界面截图说明

### 首页（管理员视角）
```
┌─────────────────────────────────────┐
│  公司公告                            │
│  查看最新的公司公告和意见询问         │
├─────────────────────────────────────┤
│  [🔍 搜索公告或意见询问...]          │
├─────────────────────────────────────┤
│  [全部] [公告] [意见询问]            │
│  [➕ 新增公告] [💡 新增意见询问]     │ ← 仅管理员可见
├─────────────────────────────────────┤
│  📌 公告                             │
│  重要通知                            │
│  2024-01-01    [🗑️ 删除]             │ ← 仅管理员可见
│  ...                                │
└─────────────────────────────────────┘
```

### 管理后台
```
┌─────────────────────────────────────┐
│  管理后台                            │
│  员工管理                            │
├─────────────────────────────────────┤
│  [👥 新增员工]                       │
├─────────────────────────────────────┤
│  用户名 | 真实姓名 | 邮箱 | ... | 操作│
│  admin  | 管理员    | ... | ... | 🗑️删除│
│  张三   | 张三      | ... | ... | 🗑️删除│
└─────────────────────────────────────┘
```

## 数据流

1. **加载数据**
   - 首页加载时调用 `GET /api/announcements?limit=100`
   - 保存到 `allData`

2. **搜索/筛选**
   - 输入搜索词或点击筛选按钮
   - `filteredData` computed 自动计算过滤结果
   - 重置 `currentPage` 到 1
   - `displayedAnnouncements` 计算当前页数据

3. **创建公告**（仅管理员）
   - 填写表单
   - 调用 `POST /api/announcements`
   - 成功后重新加载列表

4. **删除公告**（仅管理员）
   - 点击删除按钮
   - 确认对话框
   - 调用 `DELETE /api/announcements/:id`
   - 成功后重新加载列表

## 安全性

- 创建和删除功能通过 `authStore.isAdmin` 控制访问
- 后端 API 已有管理员权限验证
- 删除操作有二次确认，防止误操作

## 注意事项

1. 搜索功能是客户端搜索，基于已加载的数据
2. 分页也是客户端分页
3. 如果数据量超过100条，需要调整后端limit参数
4. 删除操作不可恢复，建议定期备份数据

## 后续优化建议

1. 添加搜索历史记录
2. 支持高级搜索（按时间范围、按创建人等）
3. 添加批量删除功能
4. 添加公告编辑功能
5. 添加公告置顶功能
