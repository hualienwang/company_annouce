# é‚®ä»¶å‘é€é…ç½®è¯´æ˜

## ä¸ºä»€ä¹ˆå½“å‰æ˜¯æ¨¡æ‹Ÿæ¨¡å¼ï¼Ÿ

å½“å‰ç³»ç»Ÿä½¿ç”¨**æ¨¡æ‹Ÿæ¨¡å¼**å‘é€é‚®ä»¶ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. **å¼€å‘ç¯å¢ƒä¾¿åˆ©æ€§**ï¼šåœ¨å¼€å‘æµ‹è¯•é˜¶æ®µï¼Œæ— éœ€é…ç½®çœŸå®çš„ SMTP æœåŠ¡å™¨å³å¯æµ‹è¯•é‚®ä»¶åŠŸèƒ½
2. **é˜²æ­¢é…ç½®é”™è¯¯**ï¼šé¿å…å›  SMTP é…ç½®é”™è¯¯å¯¼è‡´ç³»ç»Ÿå¼‚å¸¸
3. **å¿«é€ŸéªŒè¯åŠŸèƒ½**ï¼šå¯ä»¥åœ¨æ§åˆ¶å°æŸ¥çœ‹é‚®ä»¶å†…å®¹ï¼ŒéªŒè¯ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®

### æ¨¡æ‹Ÿæ¨¡å¼çš„å·¥ä½œåŸç†

åœ¨ `backend/api/auth.py` ä¸­çš„ `send_email` å‡½æ•°ä¸­ï¼š

```python
# é»˜è®¤é…ç½®ï¼ˆå ä½ç¬¦ï¼‰
smtp_username = "your_email@gmail.com"

# è‡ªåŠ¨æ£€æµ‹æ˜¯å¦ä¸ºæ¨¡æ‹Ÿæ¨¡å¼
is_mock_mode = smtp_username == "your_email@gmail.com"

if is_mock_mode:
    # æ¨¡æ‹Ÿæ¨¡å¼ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºé‚®ä»¶ä¿¡æ¯
    print("ã€é‚®ä»¶å‘é€æ¨¡æ‹Ÿæ¨¡å¼ã€‘")
    print(f"æ”¶ä»¶äºº: {email_request.to_email}")
    print(f"ä¸»é¢˜: {email_request.subject}")
    print(f"å†…å®¹:\n{email_request.body}")

    return {
        "message": "é‚®ä»¶å‘é€æˆåŠŸï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰",
        "mock_mode": True,
        ...
    }
```

å½“æ£€æµ‹åˆ° `smtp_username` è¿˜æ˜¯é»˜è®¤å€¼ `your_email@gmail.com` æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ¨¡å¼ã€‚

---

## å¦‚ä½•å¯ç”¨çœŸå®é‚®ä»¶å‘é€ï¼Ÿ

### æ–¹æ³• 1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­é…ç½® SMTP ä¿¡æ¯ï¼š

```bash
# Linux/Mac
export SMTP_SERVER="smtp.gmail.com"
export SMTP_PORT="587"
export SMTP_USERNAME="your_real_email@gmail.com"
export SMTP_PASSWORD="your_app_password"
export SMTP_FROM_EMAIL="your_real_email@gmail.com"

# Windows PowerShell
set SMTP_SERVER="smtp.gmail.com"
set SMTP_PORT="587"
set SMTP_USERNAME="your_real_email@gmail.com"
set SMTP_PASSWORD="your_app_password"
set SMTP_FROM_EMAIL="your_real_email@gmail.com"
```

### æ–¹æ³• 2ï¼šåˆ›å»º `.env` æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_real_email@gmail.com
SMTP_PASSWORD=your_app_password
SMTP_FROM_EMAIL=your_real_email@gmail.com
```

ç„¶ååœ¨ `backend/api/auth.py` ä¸­ä¿®æ”¹ä»£ç ä»¥è¯»å–ç¯å¢ƒå˜é‡ã€‚

---

## å¸¸ç”¨ SMTP æœåŠ¡å™¨é…ç½®

### Gmail

```python
smtp_server = "smtp.gmail.com"
smtp_port = 587
smtp_username = "your_email@gmail.com"
smtp_password = "your_app_password"  # éœ€è¦ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç 
```

**æ³¨æ„**ï¼šGmail éœ€è¦å¯ç”¨åº”ç”¨ä¸“ç”¨å¯†ç ï¼š
1. è®¿é—® https://myaccount.google.com/security
2. å¯ç”¨"ä¸¤æ­¥éªŒè¯"
3. ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 

### 163 é‚®ç®±

```python
smtp_server = "smtp.163.com"
smtp_port = 465
smtp_username = "your_email@163.com"
smtp_password = "your_email_password"
```

### QQ é‚®ç®±

```python
smtp_server = "smtp.qq.com"
smtp_port = 587
smtp_username = "your_email@qq.com"
smtp_password = "your_auth_code"  # éœ€è¦ä½¿ç”¨æˆæƒç 
```

**æ³¨æ„**ï¼šQQ é‚®ç®±éœ€è¦å¯ç”¨ SMTP æœåŠ¡å¹¶è·å–æˆæƒç ï¼š
1. ç™»å½• QQ é‚®ç®± â†’ è®¾ç½® â†’ è´¦æˆ·
2. å¼€å¯ POP3/IMAP/SMTP æœåŠ¡
3. ç”Ÿæˆæˆæƒç 

### ä¼ä¸šé‚®ç®±ï¼ˆExchangeï¼‰

```python
smtp_server = "smtp.office365.com"
smtp_port = 587
smtp_username = "your_email@company.com"
smtp_password = "your_password"
```

---

## ä¿®æ”¹ä»£ç ç¤ºä¾‹

å¦‚æœè¦ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®ï¼Œéœ€è¦ä¿®æ”¹ `backend/api/auth.py`ï¼š

```python
@router.post("/send-email")
async def send_email(
    email_request: EmailRequest,
    current_user: User = Depends(get_current_active_user)
):
    """å‘é€é‚®ä»¶"""

    # ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®
    smtp_server = os.getenv("SMTP_SERVER", "smtp.gmail.com")
    smtp_port = int(os.getenv("SMTP_PORT", "587"))
    smtp_username = os.getenv("SMTP_USERNAME", "your_email@gmail.com")
    smtp_password = os.getenv("SMTP_PASSWORD", "your_app_password")
    smtp_from_email = os.getenv("SMTP_FROM_EMAIL", smtp_username)

    # æ¨¡æ‹Ÿæ¨¡å¼æ£€æµ‹
    is_mock_mode = smtp_username == "your_email@gmail.com" and \
                   smtp_password == "your_app_password"

    # ... å…¶ä½™ä»£ç ä¸å˜
```

---

## æµ‹è¯•é‚®ä»¶å‘é€

### åœ¨æ¨¡æ‹Ÿæ¨¡å¼ä¸‹æµ‹è¯•

1. ç™»å½•ç³»ç»Ÿ
2. è®¿é—®ç®¡ç†åå°ï¼ˆ/adminï¼‰
3. ç‚¹å‡»æŸä¸ªå‘˜å·¥çš„"ğŸ“§ Email"æŒ‰é’®
4. å¡«å†™é‚®ä»¶å†…å®¹å¹¶å‘é€
5. æŸ¥çœ‹åç«¯æ§åˆ¶å°è¾“å‡º

**æ¨¡æ‹Ÿæ¨¡å¼çš„è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "message": "é‚®ä»¶å‘é€æˆåŠŸï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰",
  "mock_mode": true,
  "to": "user@example.com",
  "subject": "æµ‹è¯•é‚®ä»¶"
}
```

### åœ¨çœŸå®æ¨¡å¼ä¸‹æµ‹è¯•

1. é…ç½®çœŸå®çš„ SMTP ä¿¡æ¯
2. é‡å¯åç«¯æœåŠ¡
3. é‡å¤ä¸Šè¿°æ“ä½œ
4. æ£€æŸ¥æ”¶ä»¶ç®±æ˜¯å¦æ”¶åˆ°é‚®ä»¶

---

## å®‰å…¨å»ºè®®

1. **ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç **ï¼šå§‹ç»ˆä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
2. **ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç **ï¼šä¸è¦ä½¿ç”¨ä¸ªäººè´¦æˆ·å¯†ç 
3. **ä¿æŠ¤ç¯å¢ƒå˜é‡**ï¼šä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
4. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸“ç”¨ SMTP æœåŠ¡**ï¼šè€ƒè™‘ä½¿ç”¨ SendGridã€Mailgun ç­‰ä¸“ä¸šæœåŠ¡

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šé‚®ä»¶å‘é€å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- SMTP é…ç½®é”™è¯¯
- ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
- ç«¯å£å·ä¸æ­£ç¡®
- é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯æ—¥å¿—
2. éªŒè¯ SMTP é…ç½®
3. å°è¯•ä½¿ç”¨å…¶ä»– SMTP ç«¯å£ï¼ˆ587 æˆ– 465ï¼‰
4. ç¡®ä¿ç½‘ç»œå¯ä»¥è®¿é—® SMTP æœåŠ¡å™¨

### é—®é¢˜ 2ï¼šGmail è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** `AuthenticationError`

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®ä¿ Gmail è´¦æˆ·å·²å¼€å¯ä¸¤æ­¥éªŒè¯
2. ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 
3. ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç è€Œéè´¦æˆ·å¯†ç 

### é—®é¢˜ 3ï¼šé‚®ä»¶è¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®ä¿å‘ä»¶äººåŸŸåæœ‰è‰¯å¥½çš„ SPF è®°å½•
2. é¿å…å‘é€å¤§é‡ç›¸ä¼¼å†…å®¹
3. æ·»åŠ  DKIM ç­¾å
4. ä½¿ç”¨ä¸“ä¸šçš„é‚®ä»¶å‘é€æœåŠ¡

---

## ç”Ÿäº§ç¯å¢ƒå»ºè®®

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ï¼š

1. **ä½¿ç”¨ä¸“ä¸šé‚®ä»¶æœåŠ¡**ï¼š
   - SendGrid (https://sendgrid.com)
   - Mailgun (https://www.mailgun.com)
   - AWS SES (https://aws.amazon.com/ses)

2. **å®ç°é‚®ä»¶é˜Ÿåˆ—**ï¼š
   - ä½¿ç”¨ Celery æˆ– Redis Queue å¤„ç†å¼‚æ­¥å‘é€
   - é¿å…è¯·æ±‚é˜»å¡

3. **æ·»åŠ é‚®ä»¶æ¨¡æ¿**ï¼š
   - ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“
   - æ”¯æŒå¯Œæ–‡æœ¬é‚®ä»¶

4. **æ—¥å¿—è®°å½•**ï¼š
   - è®°å½•æ‰€æœ‰å‘é€çš„é‚®ä»¶
   - è·Ÿè¸ªå‘é€çŠ¶æ€

5. **é‡è¯•æœºåˆ¶**ï¼š
   - å¤±è´¥åè‡ªåŠ¨é‡è¯•
   - æŒ‡æ•°é€€é¿ç­–ç•¥
